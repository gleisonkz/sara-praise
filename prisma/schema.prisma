datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model Ministry {
  ministryID Int       @id @default(autoincrement())
  name       String
  ownerID    Int
  owner      User      @relation(fields: [ownerID], references: [userID])
  songs      Song[]
  members    Member[]
  scales     Scale[]
  songKeys   SongKey[]
  roles      Role[]
}

model Role {
  roleID  Int    @id @default(autoincrement())
  name    String
  iconUrl String

  members            Member[]
  ministry           Ministry[]
}

model User {
  userID   Int        @id @default(autoincrement())
  name     String
  email    String     @unique
  password String
  imageURL String     @default("")
  ministry Ministry[]
  member  Member[]
}

model Member {
  memberID   Int @id @default(autoincrement())
  ministryID Int

  userID      Int
  user        User @relation(fields: [userID], references: [userID])
  ministry    Ministry      @relation(fields: [ministryID], references: [ministryID], onDelete: Cascade)
  permissions Permission[]
  participant Participant[]
  roles       Role[]
}


model Permission {
  permissionID Int     @id @default(autoincrement())
  name         String
  member       Member? @relation(fields: [memberID], references: [memberID])
  memberID     Int?
}

model Participant {
  participantID Int    @id @default(autoincrement())
  memberID      Int
  scaleID       Int
  member        Member @relation(fields: [memberID], references: [memberID])
  scale         Scale @relation(fields: [scaleID], references: [scaleID])
}

model SongKey {
  songKeyID  Int      @id @default(autoincrement())
  name       String
  song       Song[]
  ministryID Int
  ministry   Ministry @relation(fields: [ministryID], references: [ministryID])
}

model Scale {
  scaleID Int      @id @default(autoincrement())
  title   String
  date    DateTime
  notes   String

  ministryID   Int
  ministry     Ministry      @relation(fields: [ministryID], references: [ministryID])
  participants Participant[]
  songs        Song[]
}

model Song {
  songID       Int      @id @default(autoincrement())
  title        String
  tags         String[]
  observations String
  audioUrl     String
  youtubeUrl   String
  lyricUrl     String
  chordsUrl    String
  artistID   Int
  keyID      Int
  ministryID Int
  artist     Artist   @relation(fields: [artistID], references: [artistID])
  key        SongKey  @relation(fields: [keyID], references: [songKeyID])
  ministry   Ministry @relation(fields: [ministryID], references: [ministryID])
  scale      Scale[]
}

model Artist {
  artistID Int    @id @default(autoincrement())
  name     String
  song     Song[]
}
